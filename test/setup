#!/bin/sh

if [ -z "${ZSH_VERSION:-}" ]; then
  test_root="${BASH_SOURCE[0]%/*}"
else
  test_root="${(%):-%N}"
  test_root="${test_root%/*}"
fi

export CHPHAROS_ROOT="${test_root}/test-binaries"
mkdir -p "${CHPHAROS_ROOT}"

[ -f "${CHPHAROS_ROOT}/versions/1.0.0/pharos-cluster" ] && \
  [ -f "${CHPHAROS_ROOT}/versions/1.0.0/kubectl" ] && \
  [ -f "${CHPHAROS_ROOT}/versions/1.2.2/pharos-cluster" ] && \
  [ -f "${CHPHAROS_ROOT}/versions/1.2.2/kubectl" ] &&
  echo "Already installed test binaries" && \
  exit 0

. "${test_root}"/../share/chpharos/chpharos.sh

chpharos install 1.0.0
chpharos install 1.2.2
chpharos reset
